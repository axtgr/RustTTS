# Фаза 1 — Текстовый пайплайн (нормализация + токенизация)

## Цель
Обеспечить корректную нормализацию RU/EN и токенизацию, совместимую с моделью, с низкой латентностью.

## Epics → Stories → Subtasks
- Epic: Нормализация текста
  - Story: Базовые правила RU/EN
    - Subtask: Унификация кавычек/дефисов/пробелов.
    - Subtask: Числа, даты, проценты, валюты, единицы (км, руб, °C).
    - Subtask: Обработка смешанного текста RU/EN.
  - Story: Пайплайн правил
    - Subtask: Trait `Rule`, композитный executor, порядок применения.
    - Subtask: Lang-detection hint, fallback по умолчанию.
  - Story: Тесты/корпуса
    - Subtask: Табличные unit-тесты.
    - Subtask: Golden корпус для нормализации (вход → нормализованный текст).
- Epic: Токенизация
  - Story: Совместимый токенайзер
    - Subtask: Импорт/чтение vocab (BPE/Unigram), спец-токены BOS/EOS/паузы.
    - Subtask: Проверка совпадения с эталонными токенами (golden).
  - Story: Потоковый encode
    - Subtask: Разбиение по предложениям/спанам.
    - Subtask: Возврат offsets для логов/диагностики.
  - Story: Тесты
    - Subtask: Unit для спец-токенов и смешанных языков.
    - Subtask: Golden: текст → ожидаемые ids.

## Deliverables
- Крейты `text-normalizer`, `text-tokenizer` с публичными API.
- Набор тестов (unit + golden) и мини-корпус.
- Документация по совместимости токенов.

## DoD
- CLI `--dry-run` выводит нормализованный текст и токены, совпадающие с golden.
- Производительность: потоковая токенизация < 5 мс на короткий запрос (на CPU реф. машины).

## Риски
- Несовпадение токенов с референсом → качество падает: смягчение — golden и checksum vocabs.
- Неполная нормализация смешанного текста: смягчение — тесты на RU/EN mix.

## Метрики проверки
- Процент совпадения токенов с эталоном: 100% на golden наборе.
- Латентность нормализация+токенизация: p95 < 10 мс (CPU реф.).
